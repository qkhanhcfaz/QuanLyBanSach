<%- include('../partials/header') %>

    <div class="container py-5">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3">
                <%- include('../partials/profile-sidebar', { activePage: 'favorites' }) %>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="h3 mb-0">Sách yêu thích của bạn</h1>
                    <div class="px-3 py-1 border rounded bg-light">
                        <span class="text-dark">
                            <%= totalCount %> sản phẩm
                        </span>
                    </div>
                </div>

                <!-- Lưới sản phẩm -->
                <% if (products && products.length> 0) { %>
                    <div class="row row-cols-2 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
                        <% products.forEach(product=> { %>
                            <div class="col">
                                <div class="card h-100 product-card position-relative shadow-sm border-0">
                                    <div class="position-relative">
                                        <a href="/products/<%= product.id %>">
                                            <img class="card-img-top"
                                                src="<%= product.img || '/images/placeholder.png' %>"
                                                alt="<%= product.ten_sach %>">
                                        </a>
                                    </div>
                                    <div class="card-body d-flex flex-column p-3">
                                        <h6 class="card-title flex-grow-1"
                                            style="display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; line-height: 1.4em; height: 2.8em; font-size: 0.95rem;">
                                            <a href="/products/<%= product.id %>" class="text-decoration-none text-dark"
                                                title="<%= product.ten_sach %>">
                                                <%= product.ten_sach %>
                                            </a>
                                        </h6>
                                        <p class="card-text text-danger fw-bold mb-0">
                                            <%= parseFloat(product.gia_bia).toLocaleString('vi-VN') %>đ
                                        </p>
                                    </div>
                                    <div class="card-footer bg-white border-0 p-3 d-flex gap-2">
                                        <button onclick="addToCart('<%= product.id %>')"
                                            class="btn btn-sm btn-primary flex-grow-1">Thêm vào giỏ</button>

                                        <!-- Logic nút yêu thích -->
                                        <button class="btn btn-favorite-card btn-favorite border"
                                            data-id="<%= product.id %>" title="Bỏ thích">
                                            <i class="fas text-danger fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                    </div>

                    <!-- Pagination -->
                    <% if (pagination && pagination.totalPages> 1) { %>
                        <div class="d-flex justify-content-center mt-5">
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    <li class="page-item <%= pagination.currentPage === 1 ? 'disabled' : '' %>">
                                        <a class="page-link" href="?page=<%= pagination.currentPage - 1 %>"
                                            aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>

                                    <% for(let i=1; i <=pagination.totalPages; i++) { %>
                                        <li class="page-item <%= pagination.currentPage === i ? 'active' : '' %>">
                                            <a class="page-link" href="?page=<%= i %>">
                                                <%= i %>
                                            </a>
                                        </li>
                                        <% } %>

                                            <li
                                                class="page-item <%= pagination.currentPage === pagination.totalPages ? 'disabled' : '' %>">
                                                <a class="page-link" href="?page=<%= pagination.currentPage + 1 %>"
                                                    aria-label="Next">
                                                    <span aria-hidden="true">&raquo;</span>
                                                </a>
                                            </li>
                                </ul>
                            </nav>
                        </div>
                        <% } %>

                            <% } else { %>
                                <div class="text-center p-5 border rounded bg-light mt-4">
                                    <i class="far fa-heart fa-3x text-muted mb-3"></i>
                                    <p class="lead mb-3">Bạn chưa có sản phẩm yêu thích nào.</p>
                                    <a href="/products" class="btn btn-primary px-4">Khám phá sách ngay</a>
                                </div>
                                <% } %>
            </div>
        </div>
    </div>

    <script src="/js/cart.js"></script>
    <script src="/js/favorite.js"></script>
    <%- include('../partials/footer') %>